<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Лічильник</title>
</head>
<body>
    <h1>Лічильник: <span id="counter">0</span></h1>
    <button id="permissionBtn">Отримати дозвіл на фоновий режим</button>

    <!-- Поле для введення нового значення лічильника -->
    <input type="number" id="counterInput" min="0" max="100" placeholder="Оновити лічильник">
    <button id="updateCounterBtn">Оновити</button>

    <script>
        let maxNumber = 100;
        let number = parseInt(localStorage.getItem('number')) || 0;
        let stopwatchStartTime = parseInt(localStorage.getItem('stopwatchStartTime')) || Date.now();

        document.getElementById("counter").innerText = number;

        // Оновлюємо лічильник кожні 2 хвилини
        setInterval(() => {
            if (number < maxNumber) {
                number++;
                document.getElementById("counter").innerText = number;
                localStorage.setItem('number', number); // Оновлюємо значення в localStorage
            }
        }, 120000); // 2 хвилини

        // Оновлення лічильника через введення користувача
        document.getElementById("updateCounterBtn").addEventListener("click", () => {
            const newValue = parseInt(document.getElementById("counterInput").value);
            if (!isNaN(newValue) && newValue >= 0 && newValue <= maxNumber) {
                number = newValue;
                localStorage.setItem('number', number); // Оновлюємо значення
                const currentTime = Date.now();
                localStorage.setItem('stopwatchStartTime', currentTime); // Оновлюємо час
                stopwatchStartTime = currentTime;
                location.reload(); // Перезапускаємо сторінку з новими налаштуваннями
            }
        });

        // Кнопка для отримання дозволу на фоновий режим
        document.getElementById("permissionBtn").addEventListener("click", async () => {
            if ('Notification' in window) {
                let permission = await Notification.requestPermission();
                if (permission === "granted") {
                    alert("Дозвіл на отримання повідомлень надано!");
                } else {
                    alert("Дозвіл на повідомлення не надано!");
                }
            } else {
                alert("Ваш браузер не підтримує повідомлення.");
            }
        });

        // Реєстрація Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(registration => {
                console.log('Service Worker зареєстровано:', registration);
            }).catch(error => {
                console.log('Помилка реєстрації Service Worker:', error);
            });
        }
    </script>
</body>
</html>
